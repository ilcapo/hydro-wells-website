<!-- home/templates/home/blog_detail.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - HydroWells{% endblock %}

{% block content %}

<meta name="description"
  content="Don't ignore these critical warning signs from your well system. Discover when your well needs urgent professional attention to prevent major problems.">
<meta name="keywords"
  content="signs well needs repair, well emergency symptoms, bad well water taste, weak well water pressure, well pump noise">
<div class="container my-5">
  <!-- Breadcrumb mejorado -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb breadcrumb-chevron p-3 bg-body-tertiary rounded">
      <li class="breadcrumb-item">
        <a class="link-body-emphasis" href="{% url 'home' %}">
          <i class="fas fa-home me-1"></i>Inicio
        </a>
      </li>
      <li class="breadcrumb-item">
        <a class="link-body-emphasis" href="{% url 'blog_list' %}">Blog</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">{{ post.title }}</li>
    </ol>
  </nav>

  <div class="row g-5">
    <!-- Columna principal del contenido -->
    <div class="col-lg-8">
      <!-- Encabezado del artículo mejorado -->
      <article class="blog-post">
        <header class="mb-4">
          <h1 class="display-5 fw-bold mb-3 text-primary">{{ post.title }}</h1>

          <div class="d-flex flex-wrap align-items-center gap-3 text-muted mb-4">
            <div class="d-flex align-items-center">
              <i class="fas fa-user me-2"></i>
              <span>Por <strong>{{ post.author }}</strong></span>
            </div>
            <div class="d-flex align-items-center">
              <i class="far fa-calendar-alt me-2"></i>
              <span>{{ post.published_date|date:"F d, Y" }}</span>
            </div>
            {% if post.category %}
            <div>
              <span class="badge bg-secondary bg-opacity-10 text-secondary">
                <i class="fas fa-tag me-1"></i>{{ post.category.name }}
              </span>
            </div>
            {% endif %}
          </div>

          {% if post.excerpt %}
          <p class="lead text-muted border-start border-primary border-4 ps-3 ms-1">
            {{ post.excerpt }}
          </p>
          {% endif %}
        </header>

        {% if post.image %}
        <figure class="mb-5">
          <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid rounded shadow"
            style="width: 100%; height: 450px; object-fit: cover;">
          {% if post.image_caption %}
          <figcaption class="figure-caption text-center mt-2">{{ post.image_caption }}</figcaption>
          {% endif %}
        </figure>
        {% endif %}

        <!-- Contenido del artículo mejorado -->
        <div class="blog-content">
          <!-- Mostrar contenido estructurado si existe -->
          {% if post.structured_content %}
          {% with structured_data=post.get_structured_content %}
          <!-- Introducción -->
          {% if structured_data.introduction %}
          <p class="lead mb-4">{{ structured_data.introduction }}</p>
          {% endif %}

          <!-- Items -->
          {% if structured_data.items %}
          {% for item in structured_data.items %}
          <div class="mb-4 structured-item">
            {% if item.title %}
            <h3 class="mt-4 mb-3">{{ item.title }}</h3>
            {% endif %}

            {% if item.description %}
            <p>{{ item.description }}</p>
            {% endif %}

            {% if item.action %}
            <div class="bg-warning bg-opacity-10 p-3 rounded border-start border-warning border-4">
              <h5 class="mb-2"><i class="fas fa-exclamation-triangle text-warning me-2"></i>What to do?</h5>
              <p class="mb-0">{{ item.action }}</p>
            </div>
            {% endif %}

            {% if item.solution %}
            <div class="bg-success bg-opacity-10 p-3 rounded border-start border-success border-4">
              <h5 class="mb-2"><i class="fas fa-lightbulb text-success me-2"></i>Solution</h5>
              <p class="mb-0">{{ item.solution }}</p>
            </div>
            {% endif %}
          </div>
          {% endfor %}
          {% else %}
          <!-- Si no hay items, mostrar contenido plano -->
          {{ post.content|linebreaks }}
          {% endif %}
          {% endwith %}
          {% elif post.content %}
          <!-- Mostrar contenido plano si no hay estructura -->
          {{ post.content|linebreaks }}
          {% else %}
          <p>No content available for this article.</p>
          {% endif %}
        </div>
      </article>

      <!-- Compartir en redes sociales mejorado -->
      <div class="mt-5 p-4 bg-light rounded border">
        <h5 class="mb-3"><i class="fas fa-share-alt me-2"></i>Did you find this article helpful?</h5>
        <p class="mb-3">Share it with others who might benefit:</p>
        <div class="d-flex flex-wrap gap-2">
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank"
            class="btn btn-primary">
            <i class="fab fa-facebook-f me-1"></i> Facebook
          </a>
          <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ post.title }}"
            target="_blank" class="btn btn-info text-white">
            <i class="fab fa-twitter me-1"></i> Twitter
          </a>
          <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" target="_blank"
            class="btn btn-secondary">
            <i class="fab fa-linkedin-in me-1"></i> LinkedIn
          </a>
        </div>
      </div>
    </div>

    <!-- Barra lateral mejorada -->
    <div class="col-lg-4">
      <!-- Artículos relacionados -->
      {% if related_posts %}
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-primary text-white py-3">
          <h5 class="mb-0"><i class="fas fa-bookmark me-2"></i>Related articles</h5>
        </div>
        <div class="list-group list-group-flush">
          {% for related in related_posts %}
          <a href="{{ related.get_absolute_url }}" class="list-group-item list-group-item-action">
            <div class="d-flex">
              {% if related.image %}
              <img src="{{ related.image.url }}" alt="{{ related.title }}" class="rounded me-3"
                style="width: 70px; height: 70px; object-fit: cover;">
              {% endif %}
              <div>
                <h6 class="mb-1">{{ related.title }}</h6>
                <small class="text-muted">
                  <i class="far fa-calendar me-1"></i>{{ related.published_date|date:"M d, Y" }}
                </small>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Etiquetas -->
      {% if post.tags.all %}
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-secondary text-white py-3">
          <h5 class="mb-0"><i class="fas fa-tags me-2"></i>Tags</h5>
        </div>
        <div class="card-body">
          {% for tag in post.tags.all %}
          <span class="badge bg-secondary bg-opacity-10 text-secondary me-1 mb-2">{{ tag }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- CTA Final mejorado -->
      <div class="card border-primary border-2 shadow-sm">
        <div class="card-body text-center p-4">
          <div class="mb-3">
            <i class="fas fa-headset fa-2x text-primary"></i>
          </div>
          <h5 class="card-title mb-3">Do you need help with your well?</h5>
          <p class="card-text mb-4">Our certified experts are ready to help you.</p>
          <div class="d-grid gap-2">
            <a href="{% url 'contact' %}" class="btn btn-primary">
              <i class="fas fa-file-contract me-1"></i>Request a consultation
            </a>
            <a href="tel:3015550123" class="btn btn-outline-primary">
              <i class="fas fa-phone-alt me-1"></i> Call Now
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Mejoras tipográficas */
  .blog-content {
    font-size: 1.05rem;
    line-height: 1.7;
  }

  .blog-content p {
    margin-bottom: 1.75rem;
    text-align: justify;
  }

  /* Mejoras en encabezados */
  .blog-content h3 {
    color: #0d6efd;
    font-weight: 700;
    letter-spacing: -0.5px;
  }

  /* Efectos visuales */
  .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
  }

  /* Breadcrumb mejorado */
  .breadcrumb-chevron {
    --bs-breadcrumb-divider: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E");
  }

  /* Responsive */
  @media (max-width: 991.98px) {
    .blog-content {
      font-size: 1rem;
    }

    .blog-content h3 {
      font-size: 1.5rem;
    }
  }
</style>
{% endblock %}